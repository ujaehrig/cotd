{% extends "base.html" %}

{% block title %}My Vacations - Vacation Management{% endblock %}

{% block head %}
{{ super() }}
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-umbrella-beach me-2"></i>My Vacations</h2>
    <button class="btn btn-success" 
            hx-get="{{ url_for('add_vacation') }}"
            hx-target="#vacation-form-container"
            hx-swap="innerHTML">
        <i class="fas fa-plus me-1"></i>Add Vacation
    </button>
</div>

<!-- Success/Error Messages Container -->
<div id="flash-messages"></div>

<!-- Form container for HTMX -->
<div id="vacation-form-container" class="mb-4"></div>

<div class="card">
    <div class="card-body">
        <div id="vacation-table">
            {% include 'partials/vacation_table.html' %}
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-info-circle me-2"></i>Vacation Management</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        You can add vacation periods to exclude yourself from being selected as "Catcher of the Day"
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Single-day vacations are useful for sick days or personal days
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Multi-day vacations are for longer periods like holidays
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        You can only view and manage your own vacation periods
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Function to auto-dismiss alerts after specified time
function autoDismissAlert(alertElement, delay = 5000) {
    setTimeout(() => {
        if (alertElement && alertElement.parentNode) {
            const bsAlert = new bootstrap.Alert(alertElement);
            bsAlert.close();
        }
    }, delay);
}

// Function to show success messages
function showSuccessMessage(message, autoDismiss = true) {
    const flashContainer = document.getElementById('flash-messages');
    const alertHtml = `
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
    flashContainer.innerHTML = alertHtml;
    
    // Auto-dismiss after 5 seconds if enabled
    if (autoDismiss) {
        const alert = flashContainer.querySelector('.alert');
        if (alert) {
            autoDismissAlert(alert, 5000);
        }
    }
}

// Function to show error messages
function showErrorMessage(message, autoDismiss = true) {
    const flashContainer = document.getElementById('flash-messages');
    const alertHtml = `
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
    flashContainer.innerHTML = alertHtml;
    
    // Auto-dismiss after 7 seconds for errors (slightly longer to ensure users see them)
    if (autoDismiss) {
        const alert = flashContainer.querySelector('.alert');
        if (alert) {
            autoDismissAlert(alert, 7000);
        }
    }
}

// Function to show info messages
function showInfoMessage(message, autoDismiss = true) {
    const flashContainer = document.getElementById('flash-messages');
    const alertHtml = `
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            <i class="fas fa-info-circle me-2"></i>${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
    flashContainer.innerHTML = alertHtml;
    
    // Auto-dismiss after 5 seconds if enabled
    if (autoDismiss) {
        const alert = flashContainer.querySelector('.alert');
        if (alert) {
            autoDismissAlert(alert, 5000);
        }
    }
}

// Auto-dismiss existing flash messages on page load
document.addEventListener('DOMContentLoaded', function() {
    const existingAlerts = document.querySelectorAll('.alert-dismissible');
    existingAlerts.forEach(alert => {
        // Different timing based on alert type
        let delay = 5000; // default
        if (alert.classList.contains('alert-danger')) {
            delay = 7000; // errors stay longer
        } else if (alert.classList.contains('alert-warning')) {
            delay = 6000; // warnings stay a bit longer
        }
        
        autoDismissAlert(alert, delay);
    });
});

// Listen for HTMX events
document.body.addEventListener('htmx:responseError', function(event) {
    showErrorMessage('An error occurred. Please try again.');
});

// Listen for successful vacation deletion
document.body.addEventListener('vacationDeleted', function(event) {
    showSuccessMessage('Vacation period deleted successfully!');
});
</script>
{% endblock %}
